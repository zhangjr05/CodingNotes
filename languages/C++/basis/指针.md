# æŒ‡é’ˆ Pointer

---

## 1. æŒ‡é’ˆåŸºç¡€æ¦‚å¿µ

### ğŸ¯ ä»€ä¹ˆæ˜¯æŒ‡é’ˆï¼Ÿ

æŒ‡é’ˆæ˜¯ä¸€ä¸ª**å­˜å‚¨å†…å­˜åœ°å€**çš„å˜é‡ï¼Œå®ƒ"æŒ‡å‘"å¦ä¸€ä¸ªå˜é‡çš„å†…å­˜ä½ç½®ã€‚

```cpp
int num = 42;           // æ™®é€šå˜é‡
int* ptr = &num;        // æŒ‡é’ˆå˜é‡ï¼Œå­˜å‚¨numçš„åœ°å€

cout << "å˜é‡å€¼: " << num << endl;          // è¾“å‡º: 42
cout << "å˜é‡åœ°å€: " << &num << endl;       // è¾“å‡º: 0x7fff5fbff6ac (ç¤ºä¾‹)
cout << "æŒ‡é’ˆå€¼: " << ptr << endl;          // è¾“å‡º: 0x7fff5fbff6ac
cout << "æŒ‡é’ˆæŒ‡å‘çš„å€¼: " << *ptr << endl;   // è¾“å‡º: 42
```

### ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

- `&` - **å–åœ°å€è¿ç®—ç¬¦**ï¼šè·å–å˜é‡çš„å†…å­˜åœ°å€
- `*` - **è§£å¼•ç”¨è¿ç®—ç¬¦**ï¼šè®¿é—®æŒ‡é’ˆæŒ‡å‘çš„å€¼
- **æŒ‡é’ˆå˜é‡**ï¼šå­˜å‚¨åœ°å€çš„å˜é‡
- **ç›®æ ‡å˜é‡**ï¼šæŒ‡é’ˆæŒ‡å‘çš„å˜é‡

---

## 2. æŒ‡é’ˆçš„å£°æ˜ä¸åˆå§‹åŒ–

### ğŸ“ åŸºæœ¬å£°æ˜è¯­æ³•

```cpp
æ•°æ®ç±»å‹* æŒ‡é’ˆå;
æ•°æ®ç±»å‹ *æŒ‡é’ˆå;    // ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼Œä½†ä¸æ¨è
```

### ğŸ”§ ä¸åŒç±»å‹çš„æŒ‡é’ˆ

```cpp
int a = 10;
double b = 3.14;
char c = 'A';

int* int_ptr = &a;          // æ•´å‹æŒ‡é’ˆ
double* double_ptr = &b;    // åŒç²¾åº¦æŒ‡é’ˆ
char* char_ptr = &c;        // å­—ç¬¦æŒ‡é’ˆ
```

### ğŸš« ç©ºæŒ‡é’ˆçš„è¡¨ç¤º

```cpp
int* ptr1 = nullptr;    // C++11æ¨èæ–¹å¼
int* ptr2 = NULL;       // Cé£æ ¼ï¼Œä»å¯ä½¿ç”¨
int* ptr3 = 0;          // æ•°å­—0ï¼Œä¸æ¨è
```

> **âš ï¸ é‡è¦**: æ€»æ˜¯åˆå§‹åŒ–æŒ‡é’ˆï¼Œé¿å…ä½¿ç”¨æœªåˆå§‹åŒ–çš„æŒ‡é’ˆï¼

### ğŸ“Š æŒ‡é’ˆæ•°ç»„ vs æ•°ç»„æŒ‡é’ˆ

```cpp
int arr[3] = {1, 2, 3};

// æŒ‡é’ˆæ•°ç»„ï¼šå­˜å‚¨æŒ‡é’ˆçš„æ•°ç»„
int* ptr_array[3];          // 3ä¸ªæŒ‡é’ˆç»„æˆçš„æ•°ç»„

// æ•°ç»„æŒ‡é’ˆï¼šæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆ
int (*array_ptr)[3] = &arr; // æŒ‡å‘å«3ä¸ªintçš„æ•°ç»„çš„æŒ‡é’ˆ
```

---

## 3. æŒ‡é’ˆè¿ç®—

### â• ç®—æœ¯è¿ç®—

```cpp
int arr[5] = {10, 20, 30, 40, 50};
int* ptr = arr;  // æŒ‡å‘æ•°ç»„é¦–å…ƒç´ 

ptr++;          // æŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´  (arr[1])
ptr += 2;       // å‘å‰ç§»åŠ¨2ä¸ªä½ç½® (arr[3])
ptr--;          // å‘åç§»åŠ¨1ä¸ªä½ç½® (arr[2])
```

### ğŸ“ æŒ‡é’ˆæ¯”è¾ƒ

```cpp
int* start = arr;
int* end = arr + 5;

bool result = (start < end);    // true
int distance = end - start;     // 5
```

### ğŸ”¢ æŒ‡é’ˆä¸æ•´æ•°è¿ç®—

- `ptr + n`ï¼šæŒ‡é’ˆå‘å‰ç§»åŠ¨nä¸ªå…ƒç´ 
- `ptr - n`ï¼šæŒ‡é’ˆå‘åç§»åŠ¨nä¸ªå…ƒç´ 
- `ptr1 - ptr2`ï¼šä¸¤æŒ‡é’ˆé—´çš„å…ƒç´ ä¸ªæ•°

> **ğŸ“Œ æ³¨æ„**: æŒ‡é’ˆè¿ç®—æŒ‰**å…ƒç´ å¤§å°**ç§»åŠ¨ï¼Œä¸æ˜¯æŒ‰å­—èŠ‚ï¼

---

## 4. æŒ‡é’ˆä¸æ•°ç»„

### ğŸ”— æŒ‡é’ˆä¸æ•°ç»„çš„å…³ç³»

```cpp
int arr[5] = {1, 2, 3, 4, 5};
int* ptr = arr;  // arrç­‰ä»·äº&arr[0]

// ä»¥ä¸‹è¡¨è¾¾å¼ç­‰ä»·
arr[i] == *(arr + i) == *(ptr + i) == ptr[i]
```

### ğŸ”„ æ•°ç»„éå†

```cpp
// æ–¹æ³•1ï¼šä¸‹æ ‡è®¿é—®
for (int i = 0; i < 5; i++) {
    cout << arr[i] << " ";
}

// æ–¹æ³•2ï¼šæŒ‡é’ˆè®¿é—®
for (int* p = arr; p < arr + 5; p++) {
    cout << *p << " ";
}

// æ–¹æ³•3ï¼šæŒ‡é’ˆç®—æœ¯
for (int i = 0; i < 5; i++) {
    cout << *(arr + i) << " ";
}
```

### ğŸ“ æ•°ç»„å¤§å°è®¡ç®—

```cpp
int arr[10];
int size = sizeof(arr) / sizeof(arr[0]);  // 10

void func(int arr[]) {
    // åœ¨å‡½æ•°ä¸­ï¼Œarræ˜¯æŒ‡é’ˆï¼Œä¸æ˜¯æ•°ç»„ï¼
    int size = sizeof(arr) / sizeof(arr[0]);  // é”™è¯¯ï¼
}
```

---

## 5. æŒ‡é’ˆä¸å‡½æ•°

### ğŸ“¤ å‚æ•°ä¼ é€’æ–¹å¼

#### å€¼ä¼ é€’ - ä¸æ”¹å˜åŸå€¼

```cpp
void byValue(int x) {
    x = 100;  // åªæ”¹å˜å‰¯æœ¬
}

int num = 42;
byValue(num);       // numä»ä¸º42
```

#### æŒ‡é’ˆä¼ é€’ - å¯ä»¥æ”¹å˜åŸå€¼

```cpp
void byPointer(int* x) {
    *x = 100;  // æ”¹å˜åŸå˜é‡
}

int num = 42;
byPointer(&num);    // numå˜ä¸º100
```

#### å¼•ç”¨ä¼ é€’ - æ›´ç®€æ´çš„æ–¹å¼

```cpp
void byReference(int& x) {
    x = 100;  // æ”¹å˜åŸå˜é‡
}

int num = 42;
byReference(num);   // numå˜ä¸º100
```

### ğŸ”„ å‡½æ•°è¿”å›æŒ‡é’ˆ

```cpp
int* createArray(int size) {
    int* arr = new int[size];  // åŠ¨æ€åˆ†é…
    for (int i = 0; i < size; i++) {
        arr[i] = i * i;
    }
    return arr;  // è¿”å›æŒ‡é’ˆ
}

// ä½¿ç”¨
int* myArray = createArray(5);
// ... ä½¿ç”¨æ•°ç»„
delete[] myArray;  // è®°å¾—é‡Šæ”¾å†…å­˜ï¼
```

### ğŸ¯ å‡½æ•°æŒ‡é’ˆ

```cpp
// å£°æ˜å‡½æ•°æŒ‡é’ˆ
int (*operation)(int, int);

// å®šä¹‰å‡½æ•°
int add(int a, int b) { return a + b; }
int multiply(int a, int b) { return a * b; }

// ä½¿ç”¨å‡½æ•°æŒ‡é’ˆ
operation = add;
int result1 = operation(5, 3);  // 8

operation = multiply;
int result2 = operation(5, 3);  // 15
```

---

## 6. åŠ¨æ€å†…å­˜ç®¡ç†

### ğŸ†• å•ä¸ªå˜é‡åˆ†é…

```cpp
// åˆ†é…
int* ptr = new int(42);     // åˆ†é…å¹¶åˆå§‹åŒ–
int* ptr2 = new int;        // åˆ†é…ä½†ä¸åˆå§‹åŒ–

// ä½¿ç”¨
cout << *ptr << endl;

// é‡Šæ”¾
delete ptr;
ptr = nullptr;  // é¿å…æ‚¬æŒ‚æŒ‡é’ˆ
```

### ğŸ—‚ï¸ æ•°ç»„åˆ†é…

```cpp
// åˆ†é…æ•°ç»„
int size = 10;
int* arr = new int[size];

// åˆå§‹åŒ–
for (int i = 0; i < size; i++) {
    arr[i] = i * 2;
}

// é‡Šæ”¾æ•°ç»„
delete[] arr;
arr = nullptr;
```

### ğŸ”² äºŒç»´æ•°ç»„åˆ†é…

```cpp
int rows = 3, cols = 4;

// åˆ†é…
int** matrix = new int*[rows];
for (int i = 0; i < rows; i++) {
    matrix[i] = new int[cols];
}

// ä½¿ç”¨
matrix[1][2] = 100;

// é‡Šæ”¾
for (int i = 0; i < rows; i++) {
    delete[] matrix[i];
}
delete[] matrix;
matrix = nullptr;
```

### âš ï¸ å†…å­˜ç®¡ç†è§„åˆ™

1. **é…å¯¹åŸåˆ™**: `new` å¯¹åº” `delete`ï¼Œ`new[]` å¯¹åº” `delete[]`
2. **é¿å…æ³„æ¼**: æ¯ä¸ª `new` éƒ½è¦æœ‰å¯¹åº”çš„ `delete`
3. **é¿å…é‡å¤é‡Šæ”¾**: é‡Šæ”¾åè®¾ç½®ä¸º `nullptr`
4. **é¿å…æ‚¬æŒ‚æŒ‡é’ˆ**: ä¸è¦ä½¿ç”¨å·²é‡Šæ”¾çš„æŒ‡é’ˆ

---

## 7. å¤šçº§æŒ‡é’ˆ

### ğŸ”— äºŒçº§æŒ‡é’ˆ

```cpp
int num = 100;
int* ptr1 = &num;       // ä¸€çº§æŒ‡é’ˆ
int** ptr2 = &ptr1;     // äºŒçº§æŒ‡é’ˆ

cout << num << endl;    // 100
cout << *ptr1 << endl;  // 100
cout << **ptr2 << endl; // 100

// ä¿®æ”¹å€¼
**ptr2 = 200;           // numå˜ä¸º200
```

### ğŸ”— ä¸‰çº§æŒ‡é’ˆ

```cpp
int num = 100;
int* ptr1 = &num;
int** ptr2 = &ptr1;
int*** ptr3 = &ptr2;    // ä¸‰çº§æŒ‡é’ˆ

cout << ***ptr3 << endl;  // 100
***ptr3 = 300;            // numå˜ä¸º300
```

### ğŸ¯ åº”ç”¨åœºæ™¯

- **å‡½æ•°å‚æ•°**: éœ€è¦ä¿®æ”¹æŒ‡é’ˆæœ¬èº«æ—¶
- **åŠ¨æ€äºŒç»´æ•°ç»„**: æŒ‡å‘æŒ‡é’ˆæ•°ç»„
- **é“¾è¡¨ç­‰æ•°æ®ç»“æ„**: èŠ‚ç‚¹åŒ…å«æŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆ

---

## 8. å¸¸è§é”™è¯¯ä¸æœ€ä½³å®è·µ

### âŒ å¸¸è§é”™è¯¯

#### 1. ä½¿ç”¨æœªåˆå§‹åŒ–æŒ‡é’ˆ

```cpp
int* ptr;           // æœªåˆå§‹åŒ–
*ptr = 10;          // å±é™©ï¼å¯èƒ½å´©æºƒ
```

#### 2. æ‚¬æŒ‚æŒ‡é’ˆ

```cpp
int* ptr;
{
    int temp = 42;
    ptr = &temp;    // tempçš„åœ°å€
}   // tempç¦»å¼€ä½œç”¨åŸŸ
// ptrç°åœ¨æ˜¯æ‚¬æŒ‚æŒ‡é’ˆï¼Œä½¿ç”¨å±é™©ï¼
```

#### 3. å†…å­˜æ³„æ¼

```cpp
void memoryLeak() {
    int* ptr = new int(42);
    // å¿˜è®°delete ptr;
}   // å†…å­˜æ³„æ¼ï¼
```

#### 4. é‡å¤åˆ é™¤

```cpp
int* ptr = new int(42);
delete ptr;
delete ptr;         // å±é™©ï¼é‡å¤åˆ é™¤
```

#### 5. æ•°ç»„åˆ é™¤é”™è¯¯

```cpp
int* arr = new int[10];
delete arr;         // é”™è¯¯ï¼åº”è¯¥ç”¨delete[]
```

### âœ… æœ€ä½³å®è·µ

#### 1. æ€»æ˜¯åˆå§‹åŒ–æŒ‡é’ˆ

```cpp
int* ptr = nullptr;  // å¥½ä¹ æƒ¯
```

#### 2. æ£€æŸ¥ç©ºæŒ‡é’ˆ

```cpp
if (ptr != nullptr) {
    *ptr = 10;
}
```

#### 3. é…å¯¹ç®¡ç†å†…å­˜

```cpp
int* ptr = new int(42);
// ... ä½¿ç”¨ptr
delete ptr;
ptr = nullptr;
```

#### 4. ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ (C++11)

```cpp
#include <memory>
std::unique_ptr<int> ptr = std::make_unique<int>(42);
// è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œæ— éœ€æ‰‹åŠ¨delete
```

#### 5. RAIIåŸåˆ™

```cpp
class ArrayWrapper {
private:
    int* data;
    int size;
public:
    ArrayWrapper(int s) : size(s) {
        data = new int[size];
    }
    ~ArrayWrapper() {
        delete[] data;  // è‡ªåŠ¨é‡Šæ”¾
    }
};
```

---

## 9. æ™ºèƒ½æŒ‡é’ˆç®€ä»‹

### ğŸ§  ä¸ºä»€ä¹ˆéœ€è¦æ™ºèƒ½æŒ‡é’ˆï¼Ÿ

- **è‡ªåŠ¨å†…å­˜ç®¡ç†**: æ— éœ€æ‰‹åŠ¨ delete
- **å¼‚å¸¸å®‰å…¨**: å³ä½¿æŠ›å‡ºå¼‚å¸¸ä¹Ÿä¼šæ­£ç¡®é‡Šæ”¾
- **é¿å…å¸¸è§é”™è¯¯**: å†…å­˜æ³„æ¼ã€æ‚¬æŒ‚æŒ‡é’ˆç­‰

### ğŸ¯ unique_ptr - ç‹¬å æ‰€æœ‰æƒ

```cpp
#include <memory>

// åˆ›å»º
std::unique_ptr<int> ptr = std::make_unique<int>(42);

// ä½¿ç”¨
cout << *ptr << endl;

// è½¬ç§»æ‰€æœ‰æƒ
std::unique_ptr<int> ptr2 = std::move(ptr);
// ç°åœ¨pträ¸ºnullptrï¼Œptr2æ‹¥æœ‰èµ„æº

// è‡ªåŠ¨é‡Šæ”¾ï¼Œæ— éœ€delete
```

### ğŸ¤ shared_ptr - å…±äº«æ‰€æœ‰æƒ

```cpp
// åˆ›å»º
std::shared_ptr<int> ptr1 = std::make_shared<int>(100);

// å…±äº«
std::shared_ptr<int> ptr2 = ptr1;
cout << ptr1.use_count() << endl;  // 2

// å½“æ‰€æœ‰shared_ptréƒ½é”€æ¯æ—¶ï¼Œèµ„æºæ‰è¢«é‡Šæ”¾
```

### ğŸ”— weak_ptr - å¼±å¼•ç”¨

```cpp
std::shared_ptr<int> shared = std::make_shared<int>(200);
std::weak_ptr<int> weak = shared;

// å®‰å…¨è®¿é—®
if (auto locked = weak.lock()) {
    cout << *locked << endl;
}
```
