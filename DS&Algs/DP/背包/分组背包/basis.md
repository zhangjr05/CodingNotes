# 分组背包

**有K组物品，每组有若干个物品，每组最多只能选择一个物品（也可以一个不选）**
**第`i`组的第`j`个物品重量为`w[i][j]`，价值为`v[i][j]`，背包容量为`V`**
**目标：选择物品放入背包，使总价值最大，且总重量不超过背包容量**

## 算法流程

### 状态定义

**`dp[i][j]` 考虑前`i`组物品，背包容量为`j`时，能获得的最大价值**

### 状态转移方程

**对于第`i`组，我们可以选择不拿任何物品，或者选择组内的某一个物品**
**`dp[i][j] = max(dp[i-1][j], max(dp[i-1][j-w[i][k]] + v[i][k]))` 其中`k`遍历第`i`组的所有物品**

### 一维空间优化

```python
for group in groups:
    # 必须逆序遍历容量 避免同一组物品被多次选择
    for j in range(V, 0, -1):
        for weight, value in group:
            if j >= weight:
                dp[j] = max(dp[j], dp[j - weight] + value)
```

## 变体

**每组必须选择一个物品。**

```python
dp = [float('-inf')] * (V + 1)
dp[0] = 0   # 容量为0价值为0
```
